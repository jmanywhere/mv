// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

model Raise {
  id            String           @id @default(cuid())
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  chain         Chain            @relation(fields: [chainId], references: [id])
  contract      String
  raised        BigInt
  goal          BigInt
  showcase      Boolean
  ownerId       String
  owner         User             @relation("owner", fields: [ownerId], references: [id])
  description   String
  logo_icon     String
  banner        String
  name          String
  chainId       Int
  flexibleStart Boolean
  startTime     DateTime
  referrerId    String? // wallet Address
  type          RaiseType
  referrer      User?            @relation("referrer", fields: [referrerId], references: [id])
  features      Feature[]
  writeups      Writeup[]
  socials       SocialsOnFunds[]
  TagsOnRaise   TagsOnRaise[]
  User          User?            @relation(fields: [userId], references: [id])
  userId        String?
}

model Feature {
  id       String @id @default(cuid())
  duration BigInt
  raise    Raise  @relation(fields: [raiseId], references: [id])
  raiseId  String
}

model Writeup {
  id       String @id @default(cuid())
  raise    Raise  @relation(fields: [raiseId], references: [id])
  user     User   @relation(fields: [authorId], references: [id])
  raiseId  String // uuid
  text     String
  authorId String // wallet Address
}

model User {
  id          String    @id @unique // wallet, not autogenerated
  writer      Boolean
  dev         Boolean
  auditor     Boolean
  referrer    Boolean
  other       Boolean
  otherDetail String
  Writeup     Writeup[]
  raises      Raise[]   @relation("owner")
  referred    Raise[]   @relation("referrer")
  Raise       Raise[]
}

// Necessary Model to fulfill the Many-Many relations
model SocialsOnFunds {
  raise    Raise  @relation(fields: [raiseId], references: [id])
  social   Social @relation(fields: [socialId], references: [id])
  raiseId  String
  socialId Int

  @@id([raiseId, socialId])
}

// TODO we should get a form of validation for socials. In the meantime this is going to have to be a manual process
model Social {
  id    Int              @id @unique @default(autoincrement())
  type  String
  url   String           @unique
  funds SocialsOnFunds[]
}

model Chain {
  id    Int      @id @unique // This is ChainId
  name  String
  rpcs  String[] // Free(if not well keep costs in mind) RPC URLs
  Raise Raise[]
}

model Tag {
  id          Int           @id @unique @default(autoincrement())
  name        String        @unique
  TagsOnRaise TagsOnRaise[]
}

model TagsOnRaise {
  raise   Raise  @relation(fields: [raiseId], references: [id])
  tag     Tag    @relation(fields: [tagId], references: [id])
  raiseId String
  tagId   Int

  @@id([raiseId, tagId])
}

enum SocialTypes {
  TWITTER
  FB
  DISCORD
  TELEGRAM
  MEDIUM
  REDDIT
}

enum RaiseType {
  FUNDRAISE
  CROWDSALE
  CHARITY
}
