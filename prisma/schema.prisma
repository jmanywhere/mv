// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

model Fund {
  id          String           @id @default(cuid())
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  chain       Chain            @relation(fields: [chainId], references: [id])
  contract    String
  raised      BigInt
  goal        BigInt
  showcase    Boolean
  owner       String
  description String
  logo_icon   String
  banner      String
  name        String
  chainId     Int
  features    Feature[]
  writeups    Writeup[]
  socials     SocialsOnFunds[]
}

model Feature {
  id       String @id @default(cuid())
  duration BigInt
  fund     Fund   @relation(fields: [fundId], references: [id])
  fundId   String
}

model Writeup {
  id       String @id @default(cuid())
  fund     Fund   @relation(fields: [fundId], references: [id])
  user     User   @relation(fields: [authorId], references: [id])
  fundId   String // uuid
  text     String
  authorId String // wallet Address
}

model User {
  id          String    @id @unique // wallet, not autogenerated
  writer      Boolean
  dev         Boolean
  auditor     Boolean
  other       Boolean
  otherDetail String
  Writeup     Writeup[]
}

// Necessary Model to fulfill the Many-Many relations
model SocialsOnFunds {
  fund     Fund   @relation(fields: [fundId], references: [id])
  social   Social @relation(fields: [socialId], references: [id])
  fundId   String
  socialId Int

  @@id([fundId, socialId])
}

// TODO we should get a form of validation for socials. In the meantime this is going to have to be a manual process
model Social {
  id    Int              @id @unique @default(autoincrement())
  type  String
  url   String           @unique
  funds SocialsOnFunds[]
}

model Chain {
  id   Int      @id @unique // This is ChainId
  name String
  rpcs String[] // Free(if not well keep costs in mind) RPC URLs
  Fund Fund[]
}

enum SocialTypes {
  TWITTER
  FB
  DISCORD
  TELEGRAM
  MEDIUM
  REDDIT
}
